{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estoque de Matérias-Primas</title>
    <link rel="stylesheet" href="{% static 'CSS/Estoque.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="icon" href="{% static 'imagens/icon logo TecGestão.png' %}" type="image/x-icon">
</head>
<body>

    <!-- Menu Lateral -->
    <nav class="menu-lateral">
        <div class="bnt-expandir">
            <i class="bi bi-list"></i>
        </div>
        <ul>
            <li class="item-menu">
                <a href="{% url 'home' %}">
                    <span class="icon"><i class="bi bi-house"></i></span>
                    <span class="txt-link">Início</span>
                </a>
            </li>
            <li class="item-menu">
                <a href="{% url 'planilhas' %}">
                    <span class="icon"><i class="bi bi-collection"></i></span>
                    <span class="txt-link">Planilhas</span>
                </a>
            </li>
            <li class="item-menu">
                <a href="#">
                    <span class="icon"><i class="bi bi-box-seam"></i></span>
                    <span class="txt-link">Estoque</span>
                </a>
            </li>
            <li class="item-menu">
                <a href="{% url 'produtos' %}">
                    <span class="icon"><i class="bi bi-cart3"></i></span>
                    <span class="txt-link">Produtos</span>
                </a>
            </li>
            <li class="item-menu">
                <a href="{% url 'vendas' %}">
                    <span class="icon"><i class="bi bi-coin"></i></span>
                    <span class="txt-link">Vendas</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Conteúdo principal -->
    <div class="container" style="margin-left: 80px;">
        
        <!-- Filtros -->
        <div class="filtros">
            <label for="categoria">Selecione a categoria:</label>
            <select id="categoria" name="categoria" onchange="filtrarCategoria()">
                <option value="all">Todos</option>
                <option value="Tecido">Tecido</option>
                <option value="Linha">Linha</option>
                <option value="Botões">Botões</option>
                <option value="Outros">Outros</option>
            </select>
        </div>

        <!-- Aviso de Falta -->
        <div class="aviso-falta" id="aviso-falta">
            <h2>Produtos em falta ou com baixa quantidade:</h2>
            <ul id="aviso-falta-lista"></ul>
        </div>

        <!-- Cards de Produtos -->
        <div id="cards-container">
            {% for produto in produtos %}
                {% with porcentagem=produto.quantidade|divisibleby:produto.quantidade_minima %}
    <div class="card">
        <img src="{{ produto.img_produto.url }}" alt="{{ produto.nome }}">
        <h1>{{ produto.nome }}</h1>
        <h2>Quantidade</h2>
        <span>{{ produto.quantidade }} / {{ produto.quantidade_minima }}</span>
        <div class="grafico">
            <div class="grafico-barra"
            width: {{ produto.barra }} %;
            background-color: {% if produto.em_falta %}#e74c3c{% else %}#16A085{% endif %};
            >
            </div>
        </div>
    </div>
                {% endwith %}
            {% empty %}
                <p>Nenhum produto encontrado.</p>
            {% endfor %}
        </div>

        <!-- Botão flutuante "+" -->
        <button id="abrirModal" class="botao-adicionar">+</button>

        <!-- Modal de Cadastro -->
        <div class="modal" id="modalCadastro">
            <div class="modal-conteudo">
                <span class="fechar" id="fecharModal">&times;</span>
                <h2>Cadastrar Novo Produto</h2>
                <form name="form_newItem" id="formCadastro" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="text" name="nome" id="nome-produto" placeholder="Nome do produto" required />
                    <input type="number" name="quantidade" id="quantidade-produto" placeholder="Quantidade atual" required />
                    <input type="number" name="quantidade_minima" id="estoque-minimo" placeholder="Quantidade mínima" required />
                    <input type="number" name="quantidade_maxima" id="estoque-maximo" placeholder="Quantidade maxima" required />
                    <input type="number" step="0.01" name="valor" id="valor" placeholder="Valor" required />

                    <select name="categoria" id="categoria-produto" required>
                        {% for c in categorias %}
                        <option value="{{ c.id }}">{{ c.nome }}</option>
                        {% endfor %}  
                    </select>

                    <label for="imagem-url" style="margin-top: 10px;">Imagem do produto:</label>
                    <input type="file" name="imagem-produto" id="imagem-url" accept="image/*">
                    <img id="imagem-preview" style="display:none; max-width: 100px; margin-top: 10px;" />

                    <button type="submit" name="form_newItem">Cadastrar</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Script JS externo -->
    <script src="{% static 'JSs/estoque.js' %}"></script>

</body>
</html>